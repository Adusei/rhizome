

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Rhizome Tech Spec &mdash; rhizome  documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="rhizome  documentation" href="../index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> rhizome
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../about/background.html">Background</a></li>
<li class="toctree-l2"><a class="reference internal" href="../about/functionality.html">Core Functionality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/functionality.html#uploader">Uploader</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/functionality.html#manage-system">Manage System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/functionality.html#chart-builder">Chart Builder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/functionality.html#dashboard-builder">Dashboard Builder</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../about/stack.html">Software Stack</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../about/stack.html#overview">Overview</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/stack.html#deployment-environment">Deployment Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/stack.html#development-environment">Development Environment</a></li>
<li class="toctree-l3"><a class="reference internal" href="../about/stack.html#testing-and-continuous-integration">Testing and Continuous Integration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../back-end/index.html">Backend Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../back-end/data_model.html">Data Model</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../back-end/data_model.html#datapoint-models">Datapoint Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#datapoint"><code class="docutils literal"><span class="pre">DataPoint</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#docdatapoint"><code class="docutils literal"><span class="pre">DocDataPoint</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../back-end/data_model.html#document-models">Document Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#document"><code class="docutils literal"><span class="pre">Document</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#sourcesubmission"><code class="docutils literal"><span class="pre">SourceSubmission</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#sourceobjectmap"><code class="docutils literal"><span class="pre">SourceObjectMap</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../back-end/data_model.html#indicator-models">Indicator Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#indicator"><code class="docutils literal"><span class="pre">Indicator</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../back-end/data_model.html#location-models">Location Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#location"><code class="docutils literal"><span class="pre">Location</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#locationpolygon"><code class="docutils literal"><span class="pre">LocationPolygon</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../back-end/data_model.html#campaign-models">Campaign Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#campaign"><code class="docutils literal"><span class="pre">Campaign</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../back-end/data_model.html#dashboard-models">Dashboard Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#custom-chart"><code class="docutils literal"><span class="pre">Custom</span> <span class="pre">Chart</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../back-end/data_model.html#custom-dashboard"><code class="docutils literal"><span class="pre">Custom</span> <span class="pre">Dashboard</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../back-end/migrations.html">Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../back-end/build_docs.html">Creating the Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../back-end/build_docs.html#building-back-end-documentation">Building back-end documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../back-end/build_docs.html#building-front-end-documentation">Building front-end documentation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../front-end/index.html">Front End Documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../front-end/source_data.html">Source Data ( Technical )</a></li>
<li class="toctree-l2"><a class="reference internal" href="../front-end/manage_system.html">Manage System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../front-end/react_app.html">React App</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../testing/index.html">Unit Tests</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../testing/back_end.html">Backend Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../testing/back_end.html#running-tests">Running Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../testing/back_end.html#writing-tests">Writing Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../testing/back_end.html#module-rhizome.tests">Backend Test Source Code</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../testing/front_end.html">Front End</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../testing/front_end.html#running-tests">Running Tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="../testing/front_end.html#writing-tests">Writing Tests</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../testing/front_end.html#dont-s">Dont&#8217;s:</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../deployment/index.html">Deployment</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../deployment/new_instance.html">New Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../deployment/new_instance.html#base-system-packages">Base System Packages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../deployment/new_instance.html#basic-linux-packages">Basic Linux Packages</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../deployment/new_instance.html#apache">Apache</a></li>
<li class="toctree-l4"><a class="reference internal" href="../deployment/new_instance.html#postgres">Postgres</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../deployment/new_instance.html#installing">Installing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../deployment/new_instance.html#adding-additional-linux-helper-packages">Adding additional Linux Helper Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="../deployment/new_instance.html#setting-up-users-and-creating-the-db">Setting up Users and Creating the DB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../deployment/new_instance.html#serving-static-files">Serving Static files</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../deployment/push_code.html">Pushing Code</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../deployment/push_code.html#deploying">Deploying</a></li>
<li class="toctree-l3"><a class="reference internal" href="../deployment/push_code.html#releasing-to-master">Releasing to Master</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../deployment/restore_backup_db.html">Restoring and backing up a database</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../deployment/restore_backup_db.html#copying-a-database-from-prod-to-your-local">Copying a database from prod to your local</a></li>
<li class="toctree-l3"><a class="reference internal" href="../deployment/restore_backup_db.html#backup-db-script">backup db script</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/uploader.html">CSV / Excel File Uploader</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user-guide/uploader.html#uploading-data">Uploading Data</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user-guide/uploader.html#requirements-for-uploading-documents">Requirements for Uploading Documents</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user-guide/uploader.html#procedure-for-uploading-documents">Procedure for Uploading Documents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/manage_system.html">Manage System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../user-guide/manage_system.html#indicators">Indicators</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../user-guide/manage_system.html#adding-tags">Adding Tags</a></li>
<li class="toctree-l4"><a class="reference internal" href="../user-guide/manage_system.html#adding-calculations">Adding Calculations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/chart_builder.html">Chart Builder User Guide</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user-guide/dashboard_builder.html">Dashboard Builder User Guide</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api/base_resources.html">Base Methods</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/base_resources.html#baseresource">BaseResource</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/base_resources.html#basenonmodelresource">BaseNonModelResource</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/base_resources.html#basemodelresource">BaseModelResource</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/base_resources.html#get-by-pk">GET (by PK)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/base_resources.html#get-with-query-filters">GET (with query filters)</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/base_resources.html#post">POST</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/base_resources.html#patch">PATCH</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/base_resources.html#delete">DELETE</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/base_resources.html#get-schema">GET Schema</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/base_resources.html#get-locations-from-url">Get Locations From URL</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/datapoint_api.html">DataPoint API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/datapoint_api.html#api-v1-date-datapoint"><code class="docutils literal"><span class="pre">/api/v1/date_datapoint/</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../api/datapoint_api.html#api-v1-campaign-datapoint"><code class="docutils literal"><span class="pre">/api/v1/campaign_datapoint/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/datapoint_api.html#response-format">Response Format</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/meta_resource_list.html">Core Application Resources</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api/meta_resource_list.html#api-v1-all-meta"><code class="docutils literal"><span class="pre">/api/v1/all_meta/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/meta_resource_list.html#response-format">Response Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/meta_resource_list.html#api-v1-geo"><code class="docutils literal"><span class="pre">/api/v1/geo/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/meta_resource_list.html#id1">Response Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/meta_resource_list.html#api-v1-campaign"><code class="docutils literal"><span class="pre">/api/v1/campaign/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/meta_resource_list.html#id2">Response Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/meta_resource_list.html#api-v1-custom-chart"><code class="docutils literal"><span class="pre">/api/v1/custom_chart/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/meta_resource_list.html#id3">Response Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/meta_resource_list.html#api-v1-custom-dashboard"><code class="docutils literal"><span class="pre">/api/v1/custom_dashboard/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/meta_resource_list.html#id4">Response Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/meta_resource_list.html#api-v1-location"><code class="docutils literal"><span class="pre">/api/v1/location/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/meta_resource_list.html#id5">Response Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/meta_resource_list.html#api-v1-refresh-master"><code class="docutils literal"><span class="pre">/api/v1/refresh_master/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/meta_resource_list.html#id6">Response Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/meta_resource_list.html#api-v1-source-doc"><code class="docutils literal"><span class="pre">/api/v1/source_doc/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/meta_resource_list.html#id7">Response Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/meta_resource_list.html#api-v1-source-submission"><code class="docutils literal"><span class="pre">/api/v1/source_submission/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/meta_resource_list.html#id8">Response Format</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../api/meta_resource_list.html#api-v1-transform-upload"><code class="docutils literal"><span class="pre">/api/v1/transform_upload/</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/meta_resource_list.html#id9">Response Format</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/debugging.html">Debugging the API</a></li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">rhizome</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Rhizome Tech Spec</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/next-steps/full_app_spec.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="rhizome-tech-spec">
<h1>Rhizome Tech Spec<a class="headerlink" href="#rhizome-tech-spec" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>RhizomeDB is a UNICEF initiative to lead a culture change within the U.N. as to how data is collected, cleaned and used to make data driven decisions in the field and within management.</p>
<dl class="docutils">
<dt>RhizomeDB is to have the following base functionality:</dt>
<dd><ul class="first last simple">
<li><strong>Home Page</strong>:  The Homepage can be looked at as a static dashboard that updates dynamically based on the user&#8217;s permissions and  configurations.</li>
<li><strong>Admin</strong>: Page to edit, view and create the necessary metadata in order to ingest data.  This icludes but is not limited to, locations, campaigns, indicators, users, roles and permissions.</li>
<li><strong>Source Data Management</strong>: Page to upload and manage data sources from csv uploads, 3rd party apis, our ODK engine.  This part of the application will allow a user to configure 3rd party data source, upload new data, validate data from the people they manage, map necessary metadata and view the results of the upload.  The source data app is the groundwork for <em>Performance Management</em></li>
<li><strong>Data Entry</strong>: The Data Entry module gives the user direct access to the data that the system reports on.  The source data module above sends data through an ETL process with a number of steps of validation.  The data entry application essntially allows the user to shortcut these steps in order to alter data on demand.</li>
<li><strong>Static Dashboards</strong>:  The application must provide 3 static dashboards, Management, NGA Campaign, and District.  These dashboards are complete and are to be the standard for the style and structure of the Custom Dashboard Module.</li>
<li><strong>Custom Dashboards</strong>: The custom dashboard module allows permitted users to configure a dashboard to view data how they want, and for a particular set of indicators and locations.   Think of this as stripped down web version of Tableau.</li>
</ul>
</dd>
</dl>
<div class="section" id="stack">
<h3>Stack<a class="headerlink" href="#stack" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>We will have two environments, Test and Production and each will need the following:</dt>
<dd><ul class="first last simple">
<li>One DB Server Running Postgres</li>
<li>One Web Server Running django / apache</li>
<li>One ODK Server Running ODK sync 4 Times Daily</li>
</ul>
</dd>
</dl>
<p>Total: 6 Servers &#64;
Average Data Transfer cost: ??</p>
</div>
<div class="section" id="refactoring">
<h3>Refactoring<a class="headerlink" href="#refactoring" title="Permalink to this headline">¶</a></h3>
<p>Note to Developers: <strong>We are not going to have time to de-couple these apps given our deadline</strong>  Taking over the front end code has frankly been a nightmare and we are goign to need to do a pretty serious re-write in order to achieve what we need for November 4th.</p>
<p>However, we do have time to set ourselves up for this when our November deadline passes by <strong>removing all references to django templates with the exception of the django admin.</strong>  For November 4th We will continue to serve the static assets as well as the application logic with apache / modwsgi.</p>
<dl class="docutils">
<dt>There are a few major refactoring efforts that are needed in the front end:</dt>
<dd><ul class="first last simple">
<li>Application Must be a Single Page HTML App.</li>
<li>All references to vue must be removed.</li>
<li>Remove all dependencies on Django Templates with the exception of Login and Admin pages ( and the one .html file needed to run our javascript).</li>
<li>The data acess layer was very poorly designed and though, and i&#8217;ve already done alot to help this, but there is alot more to do.  ( see more in the application overview )</li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="application-overview">
<h3>Application Overview<a class="headerlink" href="#application-overview" title="Permalink to this headline">¶</a></h3>
<p>The current application has the idea of a &#8220;dashboard&#8221; but also has.  These dashboards are effective because they allow the user to filter their experience based on who they are and what they need to see.  This big difference between the current set up and what we need in the next weeks is that from a technical perspective <strong>everything is a dashboard</strong>.  The dashboard is the entry point for everything in the application and depending on the URL, we will render subcomponents as necessary.</p>
</div>
</div>
<div class="section" id="navigation">
<h2>Navigation<a class="headerlink" href="#navigation" title="Permalink to this headline">¶</a></h2>
<p>The Navigation Drives the data flow of the application.  Each page that a user sees will be restricted by location_id and campaign_id.</p>
<p><strong>IMPORTANT</strong> : We will need to change the current Url structure such that:</p>
<blockquote>
<div><ul class="simple">
<li>/datapoints/management-dashboard/Nigeria/2015/06/</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt>becomes</dt>
<dd><ul class="first last simple">
<li>/datapoints/management-dashboard/&lt;location_id/&lt;campaign_id&gt;</li>
</ul>
</dd>
<dt>The current behavior ( using the old URL ) requires the following logic:</dt>
<dd><ul class="first last simple">
<li>indiscriminently fetch all regions in the database</li>
<li>Look up the ID for &#8220;Nigeria&#8221; or whatever fit the location variable in the URL</li>
<li>Make API calls for <em>datapoints</em> and <em>shapes</em> based on the id found in step 2.</li>
</ul>
</dd>
<dt>The New behavior will be as follows:</dt>
<dd><ul class="first last simple">
<li>Take the &lt;location_id&gt; from the URL</li>
<li>Pass &lt;location_id&gt; as the <em>parent_location_id</em> parameter to the location endpoint, <em>returning only direct children of existing location</em></li>
<li>Pass &lt;location_id&gt; to the datapoint and geo and whatever other endpoint needed to render data on the page.</li>
</ul>
</dd>
</dl>
<p>This means that whenever the user is viewing a particular page, the only data rendering on the page shoudl be relevant to the location in the url, as well as it&#8217;s direct children.  This means for instance, when i am viewing &#8220;Bauchi Province&#8221; the API only needs to return Bauchi, it&#8217;s children, and if it its lineage ( in this case that would be Nigeria) so that we can build the bread crumb.  Currently the API returns over 4000 regions, the application makes no use of almost all of these and the user experiences unnaceptable load times.</p>
<p>Also to note:  The campaign list that is rendered <strong>is dependent on locations</strong> that is you should not be able to select a campaign in pakistan if you are viewing data about nigeria.  This also means that <em>any time a location is changed in teh navigation</em> the application has to make another call to the campaign api.</p>
<div class="section" id="location-drop-down">
<h3>Location Drop Down<a class="headerlink" href="#location-drop-down" title="Permalink to this headline">¶</a></h3>
<p><strong>VERY IMPORTANT</strong> The application as it is designed currently sees huge performance hits because whenever a call is made, ALL REGIONS are returned.  We need to change this ASAP such that the API works with the application to acheive the following.</p>
<blockquote>
<div><ul>
<li><p class="first">each request from the .js must pass a location_id.</p>
</li>
<li><dl class="first docutils">
<dt>If the URL has no location provided, pass 1 ( Nigeria ) and update the URL accordingly.</dt>
<dd><p class="first last">&gt; yes not pretty but Nigeria is our main use case, and i can gaurentee you that it will have ID = 1 ;)</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="campaign-drop-down">
<h3>Campaign Drop Down<a class="headerlink" href="#campaign-drop-down" title="Permalink to this headline">¶</a></h3>
<p>The campaign drop down must have the following structure.  Right now, unlike the location drop down which is a tree view, this is flat.  We need to enhance this so we can see the following:</p>
<ul>
<li><dl class="first docutils">
<dt>Nigeria</dt>
<dd><ul class="first last">
<li><p class="first">campaign_type_1</p>
</li>
<li><dl class="first docutils">
<dt>campaign_type_2</dt>
<dd><ul class="first last simple">
<li>Campaign_type_2 in Month January 2015</li>
<li>Campaign_type_2 in Month February 2015</li>
<li>...</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">campaign_type_3</p>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The response for the api should allow the application to render this data without any front end data manipulation.  Currently, the api for Locations and indicatorsTree pivots the data in order to build the tree view.</p>
</div>
<div class="section" id="dashboard-drop-down">
<h3>Dashboard Drop Down<a class="headerlink" href="#dashboard-drop-down" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>&gt; Static Dashboards</dt>
<dd>&gt; Management
&gt; District
&gt; Campaign Monitoring</dd>
<dt>&gt; Custom Dashboards</dt>
<dd>&gt; dash_1
&gt; dash_2
&gt; dash_3</dd>
</dl>
</div>
</div>
<div class="section" id="home-page">
<h2>Home page<a class="headerlink" href="#home-page" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><a class="reference internal image-reference" href="http://s27.postimg.org/a7rr9qdlf/Rhizome_Home_Page_1.png"><img alt="http://s27.postimg.org/a7rr9qdlf/Rhizome_Home_Page_1.png" src="http://s27.postimg.org/a7rr9qdlf/Rhizome_Home_Page_1.png" style="width: 600pt;" /></a>
</div></blockquote>
</div>
<div class="section" id="admin">
<h2>Admin<a class="headerlink" href="#admin" title="Permalink to this headline">¶</a></h2>
<p>The Admin Module allows users to Add / Edit and View metadata required for the system.</p>
<p>The header at the top of the component switches the content type and renders by default the Index page.  The &#8220;Create New&#8221; button expands the top piece of the screen and renders the create form.</p>
<p>The index page has an edit link, which opens up a component underneath the admin index with the a form that allows for inline editing.  Any changes must be persisted to the database with the &#8220;submit&#8221; button.  If the API returns a success message, there should be a &#8220;saved&#8221; icon alert, and if there is an error, the front end should report this as part of teh form.</p>
<p>The index has a search functionality as well as the ability to sort and filter column values.</p>
<div class="section" id="index">
<h3>Index<a class="headerlink" href="#index" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="http://s30.postimg.org/dnzmymlq9/Rhizome_Admin_Index.png"><img alt="http://s30.postimg.org/dnzmymlq9/Rhizome_Admin_Index.png" src="http://s30.postimg.org/dnzmymlq9/Rhizome_Admin_Index.png" style="width: 600pt;" /></a>
<p>NOTE: the current ufadmin application calls data <strong>FOR EVERY CONTENT TYPE</strong> even though data is only needed for the content type that is selected.  To se this in action check out the inspector for <a class="reference external" href="http://rhizome.work/ufadmin/indicators">http://rhizome.work/ufadmin/indicators</a></p>
</div>
<div class="section" id="create">
<h3>Create<a class="headerlink" href="#create" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="http://s22.postimg.org/meahsttht/Rhizome_Admin_Create.png"><img alt="http://s22.postimg.org/meahsttht/Rhizome_Admin_Create.png" src="http://s22.postimg.org/meahsttht/Rhizome_Admin_Create.png" style="width: 600pt;" /></a>
</div>
<div class="section" id="edit">
<h3>Edit<a class="headerlink" href="#edit" title="Permalink to this headline">¶</a></h3>
<a class="reference internal image-reference" href="http://s10.postimg.org/f9k3aa2nd/Rhizome_Admin_Edit.png"><img alt="http://s10.postimg.org/f9k3aa2nd/Rhizome_Admin_Edit.png" src="http://s10.postimg.org/f9k3aa2nd/Rhizome_Admin_Edit.png" style="width: 600pt;" /></a>
</div>
<div class="section" id="content-type-behavior">
<h3>Content Type Behavior<a class="headerlink" href="#content-type-behavior" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>user:</dt>
<dd><p class="first last">-&gt; subcomponents: location_responsibilty</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>location</dt>
<dd><p class="first last">-&gt; subcomponents: associated_mappings</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>campaign</dt>
<dd><p class="first last">-&gt; subcomponents: associated_mappings</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>indicator</dt>
<dd><p class="first last">-&gt; subcomponents: associated_mappings, tags, calculations, bounds</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>tag</dt>
<dd><p class="first last">-&gt; subcomponents: tags ( view/add indicators for tag)</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="dashboards">
<h2>Dashboards<a class="headerlink" href="#dashboards" title="Permalink to this headline">¶</a></h2>
<p>As i mentioned earlier <strong>everything is a dashboard</strong>.  Lets review the flow of data when we land on a dashboard:</p>
<p>Currently The Management Dashboard Makes 21 API Calls.  This is outrageous and we should only need the following calls:</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>/api/location/?parent_location_id=&lt;x&gt;</dt>
<dd><ul class="first last simple">
<li>returns this location, it&#8217;s lineage ( parent / grandparent etc ), and it&#8217;s children</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>/api/campaign/?id=&lt;y&gt;</dt>
<dd><ul class="first last simple">
<li>Gets us the campaign object so we know the start/end date and display name</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>/api/geo/?parent_location_id=&lt;x&gt;</dt>
<dd><ul class="first last simple">
<li>Gets us the geojson to draw a map.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>/api/datapoints/  ( One of These Calls Per Chart Section )</dt>
<dd><ul class="first last simple">
<li>?location_id=&lt;x&gt;&amp;campaign_id=&lt;y&gt;&amp;indicator__in=&lt;z&gt;</li>
<li>?location_id=&lt;x&gt;&amp;campaign_start=&lt;some_date&gt;&amp;campaign_end=&lt;some_other_date&gt;&amp;&amp;indicator__in=&lt;z&gt;</li>
<li>?parent_location_id=&lt;x&gt;&amp;campaign_id=&lt;y&gt;&amp;indicator__in=&lt;z&gt;</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="custom-dashboard-functionality">
<h2>Custom Dashboard Functionality<a class="headerlink" href="#custom-dashboard-functionality" title="Permalink to this headline">¶</a></h2>
<div class="section" id="creating-a-dashboard">
<h3>Creating a dashboard<a class="headerlink" href="#creating-a-dashboard" title="Permalink to this headline">¶</a></h3>
<dl class="docutils">
<dt>New Data Models Needed:</dt>
<dd><ul class="first last simple">
<li>chart_type</li>
<li>chart_type_to_indicator</li>
<li>layout_id</li>
</ul>
</dd>
</dl>
<p>When the user clicks &#8220;create dashboard&#8221; they are taken to the screen below where they pick one indicator to get started.</p>
<p>The user must first pick the country, and then the indicator.</p>
<a class="reference internal image-reference" href="http://s28.postimg.org/pux4cy5st/ang_li_dash_01.png"><img alt="http://s28.postimg.org/pux4cy5st/ang_li_dash_01.png" src="http://s28.postimg.org/pux4cy5st/ang_li_dash_01.png" style="width: 600pt;" /></a>
<p>After picking the country, the indicator drop down should update so that we can filter to data that exists in that country.</p>
<p>NOTE: BELOW NEEDS WIREFRAME</p>
<dl class="docutils">
<dt>Next the User will pick the locations that they would like to visualize.  The location can either be:</dt>
<dd><ul class="first last simple">
<li>static: there is no location drop down that allows you to chose different location_ids</li>
<li>dynamic: for one chart, the locations can be filtered using the location title menu that we use to navigate through current dashboards.</li>
</ul>
</dd>
</dl>
<p>Note: unlike the current dashboard schema in which the dashboard is bound by location, in the new set up, the user will be able to control the location of each chart.</p>
<dl class="docutils">
<dt>In addition at this step the user will be able to choose if they want to see on their visualization:</dt>
<dd><ul class="first last simple">
<li>Just this location</li>
<li>Sub Locations of Selected.</li>
<li>Choose multiple Locations.</li>
</ul>
</dd>
</dl>
<p>So for instance, if you selected Nigeria, and wanted to see a bar chart for all of teh provinces, you would simply select &#8220;Show Sub Locations of Selected.&#8221;</p>
<p>If however you wanted to look at 5 specific districts in Pakistan, you would click &#8220;choose multiple locations&#8221;, select the 5 you wanted to visualize and click next.</p>
<p>NOTE: THE ABOVE NEEDS WIREFRAMES</p>
<p>On the next screen the user must pick the type of chart that they would like to visualize.</p>
<p>Based on the charty_type_id returned when selecting the indicator, the user will the have the option to pick from the chart types that the system allows for the above indicator.</p>
<a class="reference internal image-reference" href="http://s17.postimg.org/keksqydov/ang_li_dash_03.png"><img alt="http://s17.postimg.org/keksqydov/ang_li_dash_03.png" src="http://s17.postimg.org/keksqydov/ang_li_dash_03.png" style="width: 600pt;" /></a>
<p>After choosing the chart type, the user is taken to the existing chart builder / chart preview screen as shown below.</p>
<a class="reference internal image-reference" href="http://s8.postimg.org/imv8a40w5/ang_li_dash_05.png"><img alt="http://s8.postimg.org/imv8a40w5/ang_li_dash_05.png" src="http://s8.postimg.org/imv8a40w5/ang_li_dash_05.png" style="width: 600pt;" /></a>
<dl class="docutils">
<dt>In addition to the chart builder functionality the next screen the user should see the indicator plotted using the mechanism selected, however with this control, they will be able to perform the following operations:</dt>
<dd><ul class="first last simple">
<li>add additional indicators to the visualization ( depending on the chart type )</li>
<li>select a time frame - start_date, end_date and time period ( quarterly, monthly etc. )</li>
<li>change the &#8220;group by&#8221; logic ( group by indicators vs. locations)</li>
<li>Dev Note: all of the above attributes are to be saved in the <cite>chart_json</cite> data type</li>
</ul>
</dd>
</dl>
<p>Throughout this part of the process, changes that the user makes to the definition of the chart are to be dynamic and reflect themselves immediately in the chart preview section of the page.</p>
<p>The date will default to the most recent data when creating a chart.</p>
<p>Note: for the most part we will be using the existing chart builder functionality to accomplish the chart building / saving neccessary for Beta.</p>
<p>The following charts will have the following behaviors:</p>
</div>
<div class="section" id="chloropleth-map">
<h3>Chloropleth map<a class="headerlink" href="#chloropleth-map" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul>
<li><p class="first">Ability to switch between shape, satalite, and roadway views/</p>
</li>
<li><dl class="first docutils">
<dt>Ability to add bubbles on top of the map in which the radius of the circle represent the size of the indicator, and the point on the map represents the lon/lat of the location.</dt>
<dd><p class="first last">-&gt; <a class="reference external" href="http://bost.ocks.org/mike/bubble-map/">http://bost.ocks.org/mike/bubble-map/</a></p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="pie-chart">
<h3>Pie Chart<a class="headerlink" href="#pie-chart" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul>
<li><p class="first">When Selecting a pie chart the user selects an indicator that is the parent in a <cite>part_to_be_summed</cite> relationship.</p>
</li>
<li><dl class="first docutils">
<dt>The Pie chart will by definition be the representation of the indicators below it in the relations.</dt>
<dd><p class="first last">-&gt; for instance, if i pick &#8220;missed children&#8221; as my parent indicator, the pie chart will automatically be created with the sub reasons ( refusal, no-team, child not avail )</p>
</dd>
</dl>
</li>
<li><p class="first">The user will ( for now ) not have the ability to remove indicators and just pot those that they want int he pie chart.  This is because doing so may by nature of it&#8217;s functionality lead to mis-interperatation of data.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="scatter-plot">
<h3>Scatter Plot<a class="headerlink" href="#scatter-plot" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>When creating a scatter plot chart, the user must chose exactly two indicators.</li>
<li>both the x and the y values will be populated with the indicator chosen when initializing the chart</li>
<li>The user can pick the x or the y value as the additional indicator to be plotted, but the two indicators must be different in order for the data to be previewed.</li>
<li>The indicators available in the the drop down will have a <cite>?chart_type=scatter</cite> parameter added to the request in order to properly filter indicators for the drop down.</li>
</ul>
</div></blockquote>
<p>Note: Here it is important that we have a hover over both indicator drop downs that display the instructions for the scatter plot.  We need this for all charts, but for scatterplot fistly as this is the most complicated chart type.</p>
</div>
<div class="section" id="bar-chart">
<h3>Bar Chart<a class="headerlink" href="#bar-chart" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>Ability to group by either indicator or location</li>
<li>Choose up to 5 indicators</li>
<li>Chose quarterly or monthly break down.</li>
</ul>
</div></blockquote>
<p>For missing data: a bar is skipped if x axis is time and we dont have data for a particular month.</p>
</div>
<div class="section" id="line-chart">
<h3>Line Chart<a class="headerlink" href="#line-chart" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>No more than two Indicators can be used in a line chart vizualzation</li>
<li>The user can choose the time line such that two line charts coudld appear in the same chart for the same indicator but for different years ( See top left polio case counter in management dashboard )</li>
</ul>
</div></blockquote>
<p>For missing data: if a month does not have data, the line should &#8220;smooth&#8221; or extrapolate the difference.  So instead of going from 4-&gt;0-&gt;5 in the case where zer represents a month of missing data.. simply skip over the month without data and draw a line from 4-&gt;5.</p>
</div>
<div class="section" id="heat-map-matrix">
<h3>Heat Map Matrix<a class="headerlink" href="#heat-map-matrix" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>Note: Optional for Beta.</li>
<li>This is a way to create a heat map matrix ( see district dashboard ) for a custom set of indicators</li>
<li>See district dashboard: <a class="reference external" href="http://rhizome.work/datapoints/district-dashboard/Afghanistan/2014/11/">http://rhizome.work/datapoints/district-dashboard/Afghanistan/2014/11/</a></li>
</ul>
</div></blockquote>
</div>
<div class="section" id="chart-style-wizard">
<h3>Chart Style Wizard<a class="headerlink" href="#chart-style-wizard" title="Permalink to this headline">¶</a></h3>
<p>User clicks &#8220;you may also change additional chart settings &#8221; in order to acess the below</p>
<blockquote>
<div><ul>
<li><dl class="first docutils">
<dt>After creating the chart the user goes thorugh a &#8220;style&#8221; wizard in which they are prompted to do the following:</dt>
<dd><p class="first last">-&gt; give chart a name
-&gt; pick from one of 3 palletes for the chart
-&gt; label x-axis / y-axis
-&gt; select legend title and position</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="mounting-chart-to-layout">
<h3>Mounting Chart to Layout<a class="headerlink" href="#mounting-chart-to-layout" title="Permalink to this headline">¶</a></h3>
<p>After saving the dashboard, the user will be able to Mount the chart on a dashboard.</p>
<p>The simplest thing the user can do is mount a single visualization in which the created chart consumes the entire container.</p>
<p>Tis chart will have a unique URL as well as a export function to .jpeg, .pdf, and direct_link,</p>
<p>If however, the user wants to mount this chart on a dashboard with other charts, they can pick from a variety of layouts, mounting the created chart at the default, first position of each layout.</p>
</div>
<div class="section" id="layout-details">
<h3>Layout Details<a class="headerlink" href="#layout-details" title="Permalink to this headline">¶</a></h3>
<p>Each layout must be mobile, tablet and desktop responsive.  The current app renders nicely on a macbook, but tweaks when dealing with a desktop monitor.  It&#8217;s critical that these layouts are clean and can show on any and all screens.</p>
<a class="reference internal image-reference" href="http://s15.postimg.org/safbke97v/mount_chart_to_dash.jpg"><img alt="http://s15.postimg.org/safbke97v/mount_chart_to_dash.jpg" src="http://s15.postimg.org/safbke97v/mount_chart_to_dash.jpg" style="width: 600pt;" /></a>
<ul>
<li><dl class="first docutils">
<dt>Layout #1: Chart is Dashboard</dt>
<dd><ul class="first last simple">
<li>Simply mount the created chart on an empty dashboard and assign a unique URL for that dashboard.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Layout #2: Basic (selected by default)</dt>
<dd><ul class="first last simple">
<li>Very Similar to the management dashboard.  8 Charts , fluid layout</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Layout #3: Map</dt>
<dd><ul class="first last simple">
<li>This layout focuses on the Map on the left hand corner and provides three sections for custom chart on the right hand side.</li>
</ul>
</dd>
</dl>
</li>
<li><p class="first">Layout #4: 3 charts, no Map.  See the design for the homepage re-design for an idea how this layout works.</p>
</li>
</ul>
<p>After selecting the layout, the user simply clicks the &#8221; add new chart &#8221; option and goes to the beginning of the flow in which they are prompted to select an indicator in order to create a chart, finally mounting it on the parent dashboard.</p>
</div>
<div class="section" id="editing-a-dashboard">
<h3>Editing A Dashboard<a class="headerlink" href="#editing-a-dashboard" title="Permalink to this headline">¶</a></h3>
<p>When it comes to editing the &#8220;dashboard&#8221; there is actually very little functionality needed, as the vast amount of logic and functionality is handled in the chart builder.  The following basic functions are needed.</p>
<blockquote>
<div><ul class="simple">
<li><em>Render Dashboard</em>:  with the ability to <em>click</em> into each chart component</li>
<li><em>Select Chart</em>: User clicks on a chart section and this allows them to enter into the &#8220;chart edit&#8221; mode</li>
<li><em>Drag and Drop Chart Position</em>: The user should be able to drag and drop a chart from one position of the template into any other on the page.  When this happens, the other charts fill in the missing space based on what chart has been moved.  I.e. if chart 4 is moved to position 1, the original chart 1 will be chart 2 and so on.</li>
<li><em>Update Title</em>: Ajax POST to save the title of a dashboard</li>
<li><em>Naviation</em> : This inherits from the navigation used througout the application and will dynmically shift the data in the charts according to the <em>campaign</em> selected.  Being as that the char itself has it&#8217;s own location_control then we do not need this control for the parent (dashboard) page.</li>
<li><em>Add New Chart</em>: When viewing the dashboard in edit mode, the &#8220;add new chart&#8221; button will appear at the bottom right hand of the screen in same place that we have it currently (within the footer)</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="dashboard-export">
<h3>Dashboard Export<a class="headerlink" href="#dashboard-export" title="Permalink to this headline">¶</a></h3>
<p>When in &#8220;view&#8221; mode of a dashboard, at the bottom right there is an &#8220;export&#8221; button.</p>
<dl class="docutils">
<dt>Clicking that button has the same functionality as the chart export and will allow for:</dt>
<dd><ul class="first last simple">
<li>.pdf, .jpg, .png</li>
<li>direct link , embed code</li>
</ul>
</dd>
</dl>
<p>NOTE: This is separate from the chart export funciton, that is users should be able to export a chart itself, or the entire dashboard.</p>
</div>
<div class="section" id="other-requirements">
<h3>Other Requirements<a class="headerlink" href="#other-requirements" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>Both the Builder and the Render of the custom Dashbboard must be compatiable with all modern web browsers including:
- i.e. 10+
- firefox
- chrome</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="source-data-management">
<h2>Source Data Management<a class="headerlink" href="#source-data-management" title="Permalink to this headline">¶</a></h2>
<p>This is complete, but needs a design treatment.  <strong>THIS APP CAN EASILY BE EXTENDED TO HANDLE PERFORMANCE MANAGEMENT</strong> so it would be good to get their designer on this.</p>
</div>
<div class="section" id="data-entry">
<h2>Data Entry<a class="headerlink" href="#data-entry" title="Permalink to this headline">¶</a></h2>
<p>This is complete.</p>
</div>
<div class="section" id="back-end-business-rules-and-etl">
<h2>Back End Business Rules and ETL<a class="headerlink" href="#back-end-business-rules-and-etl" title="Permalink to this headline">¶</a></h2>
<div class="section" id="etl-source-data-backend">
<h3>ETL - Source Data Backend<a class="headerlink" href="#etl-source-data-backend" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><a class="reference internal image-reference" href="http://s27.postimg.org/hh2retykz/rhizome_data_flow.png"><img alt="http://s27.postimg.org/hh2retykz/rhizome_data_flow.png" src="http://s27.postimg.org/hh2retykz/rhizome_data_flow.png" style="width: 600pt;" /></a>
</div></blockquote>
<ol class="arabic simple">
<li>A unique source (ODK form, csv upload, .shp file) has a corresponding source_dic_id as well as a pointer to the raw data stored on the file system.</li>
<li>A user specifies configurations for this sources, for instance, the unique_id column, region and campaign columns.</li>
<li>Based on the “document_details” the raw data is translated into source_submissions.  The source_submission table has a document_id, and the raw json of the submission.</li>
<li>Based on the configurations, source_object_maps are created and queued up for a user to map.  This table contains {content_type, source_object_code, master_obj_id}. Note, if meta data mapped from other source_docs, the user need not map them again.</li>
<li>Based on the metadata mappings, submissions are transformed into datapoints with their corresponding master object ids.  This table does not have any unique indexes.,</li>
<li>A user can validate, invalidate and resolve conflicts from the source data</li>
<li>Based on validation and business logic, chose valid create datapoitns from above table. doc_datapoint and datapoint  same exact except datapoint has a unique index on region_id, campaign_id, location_id</li>
<li>Datapoint are our main source of truth, data stored and collected at the lowest level possible.  In step 8 datapoints are aggregated and values created for all parents recursively.</li>
<li>Based on metadata about indicator calculation definitions, we create new indicators based on calculations from the raw and aggregated values. For instance, % of missed children due to refusal.</li>
<li>The datapoint API and the application as a whole use campaign_id and region_id as parameters to initialize a dashboard.  So, the datapoints model here is transformed so that <em>[ region_id, campaign_id, indicator_id, value ]</em> &#8212; becomes &#8212;&gt;  <em>[ region_id, campaign_id, indicator_json ]</em></li>
</ol>
<dl class="docutils">
<dt><em>Misc Rules</em></dt>
<dd><ul class="first last simple">
<li>Duplicate datapoints (i.e. datapoints with an identical location, campaign and indicators) are prohibited.
- If a document is uploaded which contains a duplicate datapoint from a previous document, the datapoint from the new document will override the datapoint from the old document.
- If a single document contains duplicate values for a datapoint, the datapoint that appears later in the document overrides the previous datapoint. For example, if a row on line 4 contains identical location, campaign and indicator values as a row on line 7, line 7 will override line 4.</li>
</ul>
</dd>
</dl>
</div>
</div>
<div class="section" id="aggregation-and-calculation">
<h2>Aggregation and Calculation<a class="headerlink" href="#aggregation-and-calculation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>When a value in datapoints exists for location X, populate agg_datapoint with this value and NOT the aggregated values of X&#8217;s children</li>
<li>When a value in datapoint exists for a calculated indicator, choose this value as opposed the calculated value.</li>
<li>When there is a recursive relationship bewteen &#8220;PART_OF_SUM&#8221; indicators, aggregate recursively, but allow for overrides ( as noted in the use case directly above. )</li>
</ul>
<p>As an example</p>
<a class="reference internal image-reference" href="http://s29.postimg.org/cvegbyfmf/imageedit_3_6644065823.png"><img alt="http://s29.postimg.org/cvegbyfmf/imageedit_3_6644065823.png" src="http://s29.postimg.org/cvegbyfmf/imageedit_3_6644065823.png" style="width: 300pt;" /></a>
<p>In the above case, the Total number of missed children is 19 because the value of 7 overrides the aggregated values.</p>
<div class="section" id="odk">
<h3>ODK<a class="headerlink" href="#odk" title="Permalink to this headline">¶</a></h3>
<p>4 Times Daily Run a job that does the following:</p>
<blockquote>
<div><ul>
<li><p class="first">Look up in document_detail all of the documents that have been configured with the &#8220;ODK_FORM&#8221; and &#8220;ODK_HOST&#8221; configuration</p>
</li>
<li><dl class="first docutils">
<dt>For each of those strings</dt>
<dd><ul class="first last simple">
<li>Execute a odk_breifcase.jar for that from</li>
<li>Find any new submissions by looking for meta-instance-ids that do not exist in the source_submission table for that documentation.</li>
<li>Append those rows to the submission table for taht documentation</li>
<li>Sync datapoints by running RefreshMaster for the document_id of the form.</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
</div>
<div class="section" id="detailed-api-specifications">
<h2>Detailed API Specifications<a class="headerlink" href="#detailed-api-specifications" title="Permalink to this headline">¶</a></h2>
<div class="section" id="base">
<h3>Base<a class="headerlink" href="#base" title="Permalink to this headline">¶</a></h3>
<p>All api calls require a location_id and campaign_id.  The below API name spaces inherit from what is in Base.py</p>
<dl class="docutils">
<dt><em>Headers</em></dt>
<dd><ul class="first last simple">
<li>200, 400, 401, 500 etc.  Make sure that these are avaialable for FE team.</li>
</ul>
</dd>
</dl>
<p><em>Errors</em></p>
<dl class="docutils">
<dt><em>Meta</em></dt>
<dd><ul class="first last simple">
<li>Form Data</li>
<li>Pagination</li>
<li></li>
</ul>
</dd>
</dl>
</div>
<div class="section" id="geo">
<h3>geo<a class="headerlink" href="#geo" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>required parameter = parent_region_id</li>
<li>returns shapes for the parent_region requested as well as all of it&#8217;s children</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="source-data">
<h3>source_data<a class="headerlink" href="#source-data" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>POST document configurations, GET document data at various stages of ETL process</li>
<li>required params: document_id</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="manage">
<h3>manage<a class="headerlink" href="#manage" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li>add/edit/view campaigns, indicators, locations and datapoints.</li>
<li>required params: content_type</li>
<li>dashboard</li>
</ul>
</div></blockquote>
<p>New Functionality Needed
<em>/api/campaign/</em></p>
<blockquote>
<div><ul class="simple">
<li>Requires Location_id and returns only campaigns for which there is data for that location.</li>
</ul>
</div></blockquote>
</div>
</div>
</div>


          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>