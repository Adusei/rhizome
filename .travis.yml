language: python
python:
  - "2.7"

cache:
  pip: true
  directories:
    - webapp/node_modules

before_script:
  - sh -c "psql -c 'CREATE ROLE djangoapp WITH SUPERUSER LOGIN;' -U postgres; fi"
  - npm install -g npm@latest
  - npm install -g babel-eslint@4.1.6
  - cd webapp/ && npm install && npm install -g gulp && cd ..

script:
  - python manage.py test --settings=rhizome.settings.test
  - cd webapp && gulp build && gulp mocha && cd ..
  - npm run package


notifications:
  slack:
    rhisome:l1yqsBjtWznLZ2opgr2mOPiu

deploy:
  provider: codedeploy
  access_key_id: $Root_Access_Key
  secret_access_key: $Root_Secret_Key
  bucket: rhizome-dev
  application: rhizome_dev
  region: us-east-1
  deployment_group: rhizome_dev_group
  key: dist/rhizome.zip
  skip_cleanup: true
  on:
    branch: rhizome_dev_autodeploy